webpackJsonp([18],{"3etl":function(e,t){},"7PxF":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("TToO"),a=r("7+uW"),o=r("c+8m"),l=r.n(o),i=r("FL7F"),d=r("P/kE"),s=(i.a,function(e){var t={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),departmentid:e};return d.n("/department/find",t).then(function(e){return e})}),p=r("EOM2"),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.keyname="",t.dialogFormVisible=!1,t.dialogFormVisible1=!1,t.filterText="",t.tableTree=[],t.departmentlist=[],t.defaultProps={children:"children",label:"label"},t.departmentForm={departmentName:""},t.formLabelAlign1={departmentName:""},t.rules={departmentName:[{required:!0,message:"请填写科室名",trigger:"blur"}]},t.parentid="",t.updateparentid="",t.parentName="",t.updateparentName="",t.departmentcount=0,t.updatedepartmentId="",t}return n.b(t,e),t.prototype.watchCount=function(e,t){console.log("newVal",e,"oldVal",t),this.$refs.tree2.filter(e)},t.prototype.filterNode=function(e,t){return!e||-1!==t.label.indexOf(e)},t.prototype.getdepartmenttree=function(){var e,t=this;(e={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId")},d.n("/department/querytree",e).then(function(e){return e})).then(function(e){console.log(e),e.retCode?(t.tableTree=e.data.children,console.log("获取科室树",e.data)):(e.islogin||t.$alert(e.message),console.error("数据查询错误"))})},t.prototype.doNodeClick=function(e){var t=this;s(e.departmentId).then(function(e){console.log(e),e.retCode?(t.departmentlist=e.data,console.log("点击科室",e.data)):(t.$alert(e.message),console.error("数据查询错误"))})},t.prototype.handleChange=function(e){var t=this;if(e.length>0){var r=e.length-1;s(this.parentid[r]).then(function(e){console.log(e),e.retCode?t.parentName=e.data[0].departmentName:(t.$alert(e.message),console.error("数据查询错误"))})}else this.parentName=""},t.prototype.updatehandleChange=function(e){var t=this;if(e.length>0){var r=e.length-1;s(this.updateparentid[r]).then(function(e){console.log(e),e.retCode?t.updateparentName=e.data[0].departmentName:(t.$alert(e.message),console.error("数据查询错误"))})}else this.updateparentName=""},t.prototype.adddepartment=function(e){var t=this;this.$refs.departmentForm.validate(function(e){if(e){var r=t.parentid.length-1;return(n=t.departmentForm.departmentName,a=t.parentid[r],o=t.parentName,l={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),name:n,parentid:a,parentName:o},d.n("/department/add",l).then(function(e){return e})).then(function(e){e.retCode?(t.dialogFormVisible=!1,t.departmentForm={departmentName:""},t.parentid="",t.parentName="",t.departmentlist=[],t.getdepartmenttree(),t.$alert("添加成功")):(e.islogin||t.$alert(e.message),console.error("数据查询错误"))}),!0}return console.log("error submit!!"),!1;var n,a,o,l})},t.prototype.getdepartmentcount=function(){var e=this;d.n("/department/count",{}).then(function(e){return e}).then(function(t){t.retCode?e.departmentcount=t.data:(t.islogin||e.$alert(t.message),console.error("数据查询错误"))})},t.prototype.doDelete=function(e,t){var r=this;this.$confirm("是否删除该科室?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e,n;(e=t.departmentId,n={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),deptId:e},d.n("/department/delect",n).then(function(e){return e})).then(function(e){e.retCode?(r.departmentlist=[],r.getdepartmenttree()):(r.$alert(e.message),console.error("数据查询错误"))})}).catch(function(){r.$message({type:"info",message:"已取消删除"})})},t.prototype.changeModel=function(e){this.dialogFormVisible1=!0,this.formLabelAlign1=e,this.updatedepartmentId=e.departmentId},t.prototype.updatedepartment=function(e){var t=this;this.$refs.formLabelAlign1.validate(function(e){if(e){var r=t.updateparentid.length-1;return t.updatedepartmentId==t.updateparentid[r]?(t.$alert("不可绑定本科室为上级科室"),!1):((n=t.updatedepartmentId,a=t.formLabelAlign1.departmentName,o=t.updateparentid[r],l=t.updateparentName,i={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),departmentId:n,name:a,parentid:o,parentName:l},d.n("/department/update",i).then(function(e){return e})).then(function(e){e.retCode?(t.dialogFormVisible1=!1,t.departmentlist=[],t.updatedepartmentId="",t.updateparentName="",t.getdepartmenttree(),t.$alert("保存成功")):(t.$alert(e.message),console.error("数据查询错误"))}),!0)}return console.log("error submit!!"),!1;var n,a,o,l,i})},t.prototype.mounted=function(){this.getdepartmenttree(),this.getdepartmentcount()},n.a([Object(p.Watch)("filterText"),n.c("design:type",Function),n.c("design:paramtypes",[Object,Object]),n.c("design:returntype",void 0)],t.prototype,"watchCount",null),t=n.a([l()({props:{},components:{}})],t)}(a.default),c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",[r("h3",[e._v("科室管理")]),e._v(" "),r("div",{staticStyle:{"border-bottom":"1px solid #E5E5E5","padding-bottom":"20px"}},[e._v("平台科室数量统计："+e._s(e.departmentcount)+"个")]),e._v(" "),r("div",{staticStyle:{padding:"20px 0"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("新增科室")])],1)]),e._v(" "),r("el-row",{staticStyle:{margin:"10px"},attrs:{gutter:24}},[r("el-col",{attrs:{xs:24,sm:24,md:24,lg:7,xl:10}},[r("div",{staticStyle:{border:"solid 1px #e5e5e5",padding:"10px"}},[r("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),r("el-tree",{ref:"tree2",staticClass:"filter-tree",attrs:{data:e.tableTree,props:e.defaultProps,"expand-on-click-node":!1,"default-expand-all":"","highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.doNodeClick}})],1)]),e._v(" "),r("el-col",{attrs:{xs:24,sm:24,md:24,lg:15,xl:14}},[r("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.departmentlist,stripe:""}},[r("el-table-column",{attrs:{prop:"departmentName",label:"科室名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"superiorDepartmentName",label:"上级科室"}}),e._v(" "),r("el-table-column",{attrs:{prop:"sumDepar",label:"用户数量"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作",fixed:"right",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",type:"primary"},on:{click:function(r){e.changeModel(t.row)}}},[e._v("编辑")]),e._v(" "),r("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",type:"danger"},on:{click:function(r){e.doDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"增加科室",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"departmentForm",attrs:{"label-width":"100px",model:e.departmentForm,rules:e.rules}},[r("el-form-item",{attrs:{label:"新增科室",prop:"departmentName"}},[r("el-input",{model:{value:e.departmentForm.departmentName,callback:function(t){e.$set(e.departmentForm,"departmentName",t)},expression:"departmentForm.departmentName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"上级科室"}},[r("el-cascader",{attrs:{options:e.tableTree,"change-on-select":""},on:{change:e.handleChange},model:{value:e.parentid,callback:function(t){e.parentid=t},expression:"parentid"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.adddepartment("departmentForm")}}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"修改科室",visible:e.dialogFormVisible1},on:{"update:visible":function(t){e.dialogFormVisible1=t}}},[r("el-form",{ref:"formLabelAlign1",attrs:{"label-width":"100px",model:e.formLabelAlign1,rules:e.rules}},[r("el-form-item",{attrs:{label:"科室名称",prop:"departmentName"}},[r("el-input",{model:{value:e.formLabelAlign1.departmentName,callback:function(t){e.$set(e.formLabelAlign1,"departmentName",t)},expression:"formLabelAlign1.departmentName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"上级科室"}},[r("el-cascader",{attrs:{options:e.tableTree,"change-on-select":""},on:{change:e.updatehandleChange},model:{value:e.updateparentid,callback:function(t){e.updateparentid=t},expression:"updateparentid"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible1=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.updatedepartment("formLabelAlign1")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var u=r("VU/8")(m,c,!1,function(e){r("3etl")},"data-v-1a484216",null);t.default=u.exports}});
//# sourceMappingURL=18.4c0128b6cdc8a680b748.js.map