webpackJsonp([4],{"7PxF":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("TToO"),a=n("7+uW"),o=n("c+8m"),i=n.n(o),l=n("H5nj"),d=n("EOM2"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.keyname="",t.dialogFormVisible=!1,t.dialogFormVisible1=!1,t.filterText="",t.tableTree=[],t.departmentlist=[],t.defaultProps={children:"children",label:"label"},t.departmentForm={departmentName:""},t.formLabelAlign1={departmentName:""},t.rules={departmentName:[{required:!0,message:"请填写科室名",trigger:"blur"}]},t.parentid="",t.updateparentid="",t.parentName="",t.updateparentName="",t.departmentcount=0,t.updatedepartmentId="",t}return r.b(t,e),t.prototype.watchCount=function(e,t){console.log("newVal",e,"oldVal",t),this.$refs.tree2.filter(e)},t.prototype.filterNode=function(e,t){return!e||-1!==t.label.indexOf(e)},t.prototype.getdepartmenttree=function(){var e=this;l.f().then(function(t){console.log(t),t.retCode?(e.tableTree=t.data.children,console.log("获取科室树",t.data)):(t.islogin||e.$alert(t.message),console.error("数据查询错误"))})},t.prototype.doNodeClick=function(e){var t=this;l.e(e.departmentId).then(function(e){console.log(e),e.retCode?(t.departmentlist=e.data,console.log("点击科室",e.data)):(t.$alert(e.message),console.error("数据查询错误"))})},t.prototype.handleChange=function(e){var t=this;if(e.length>0){var n=e.length-1;l.e(this.parentid[n]).then(function(e){console.log(e),e.retCode?t.parentName=e.data[0].departmentName:(t.$alert(e.message),console.error("数据查询错误"))})}else this.parentName=""},t.prototype.updatehandleChange=function(e){var t=this;if(e.length>0){var n=e.length-1;l.e(this.updateparentid[n]).then(function(e){console.log(e),e.retCode?t.updateparentName=e.data[0].departmentName:(t.$alert(e.message),console.error("数据查询错误"))})}else this.updateparentName=""},t.prototype.adddepartment=function(e){var t=this;this.$refs.departmentForm.validate(function(e){if(e){var n=t.parentid.length-1;return l.a(t.departmentForm.departmentName,t.parentid[n],t.parentName).then(function(e){e.retCode?(t.dialogFormVisible=!1,t.departmentForm={departmentName:""},t.parentid=[],t.parentName="",t.departmentlist=[],t.getdepartmenttree(),t.$message("添加成功")):(e.islogin||t.$alert(e.message),console.error("数据查询错误"))}),!0}return console.log("error submit!!"),!1})},t.prototype.getdepartmentcount=function(){var e=this;l.d().then(function(t){t.retCode?e.departmentcount=t.data:(t.islogin||e.$alert(t.message),console.error("数据查询错误"))})},t.prototype.addcancel=function(){this.dialogFormVisible=!1,this.departmentForm={departmentName:""},this.parentid=[]},t.prototype.doDelete=function(e,t){var n=this;this.$confirm("是否删除该科室?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.b(t.departmentId).then(function(e){e.retCode?(n.departmentlist=[],n.getdepartmenttree()):(n.$alert(e.message),console.error("数据查询错误"))})}).catch(function(){n.$message({type:"info",message:"已取消删除"})})},t.prototype.changeModel=function(e){this.updateparentid=[],this.dialogFormVisible1=!0,this.formLabelAlign1=e,this.updatedepartmentId=e.departmentId,e.superiorDepartmentId&&this.finddeptree(e.departmentId)},t.prototype.finddeptree=function(e){var t=this;l.c(e).then(function(n){if(n.retCode){var r=[];n.data.forEach(function(e,t){e[0]&&r.push(e[0].departmentId)}),r.push(e),t.updateparentid=r}else t.$alert(n.message),console.error("数据查询错误")})},t.prototype.updatedepartment=function(e){var t=this;this.$refs.formLabelAlign1.validate(function(e){if(e){var n=t.updateparentid.length-1;return t.updatedepartmentId==t.updateparentid[n]?(t.$alert("不可绑定本科室为上级科室"),!1):(l.g(t.updatedepartmentId,t.formLabelAlign1.departmentName,t.updateparentid[n],t.updateparentName).then(function(e){e.retCode?(t.dialogFormVisible1=!1,t.departmentlist=[],t.updatedepartmentId="",t.updateparentName="",t.updateparentid=[],t.getdepartmenttree(),t.$message("保存成功")):(t.$alert(e.message),console.error("数据查询错误"))}),!0)}return console.log("error submit!!"),!1})},t.prototype.mounted=function(){this.getdepartmenttree(),this.getdepartmentcount()},r.a([Object(d.Watch)("filterText"),r.c("design:type",Function),r.c("design:paramtypes",[Object,Object]),r.c("design:returntype",void 0)],t.prototype,"watchCount",null),t=r.a([i()({props:{},components:{}})],t)}(a.default),p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",[n("h3",[e._v("科室管理")]),e._v(" "),n("div",{staticStyle:{"border-bottom":"1px solid #E5E5E5","padding-bottom":"20px"}},[e._v("平台科室数量统计："+e._s(e.departmentcount)+"个")]),e._v(" "),n("div",{staticStyle:{padding:"20px 0"}},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("新增科室")])],1)]),e._v(" "),n("el-row",{staticStyle:{margin:"10px"},attrs:{gutter:24}},[n("el-col",{attrs:{xs:24,sm:24,md:24,lg:7,xl:10}},[n("div",{staticStyle:{border:"solid 1px #e5e5e5",padding:"10px"}},[n("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),n("el-tree",{ref:"tree2",staticClass:"filter-tree",attrs:{data:e.tableTree,props:e.defaultProps,"expand-on-click-node":!1,"default-expand-all":"","highlight-current":"","filter-node-method":e.filterNode},on:{"node-click":e.doNodeClick}})],1)]),e._v(" "),n("el-col",{attrs:{xs:24,sm:24,md:24,lg:15,xl:14}},[n("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.departmentlist,stripe:""}},[n("el-table-column",{attrs:{prop:"departmentName",label:"科室名称"}}),e._v(" "),n("el-table-column",{attrs:{prop:"superiorDepartmentName",label:"上级科室"}}),e._v(" "),n("el-table-column",{attrs:{prop:"sumDepar",label:"用户数量"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",type:"primary"},on:{click:function(n){e.changeModel(t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",type:"danger"},on:{click:function(n){e.doDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"增加科室",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t},close:function(t){e.addcancel()}}},[n("el-form",{ref:"departmentForm",attrs:{"label-width":"100px",model:e.departmentForm,rules:e.rules}},[n("el-form-item",{attrs:{label:"新增科室",prop:"departmentName"}},[n("el-input",{model:{value:e.departmentForm.departmentName,callback:function(t){e.$set(e.departmentForm,"departmentName",t)},expression:"departmentForm.departmentName"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"上级科室"}},[n("el-cascader",{attrs:{clearable:"",options:e.tableTree,"change-on-select":""},on:{change:e.handleChange},model:{value:e.parentid,callback:function(t){e.parentid=t},expression:"parentid"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.addcancel()}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.adddepartment("departmentForm")}}},[e._v("确 定")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"修改科室",visible:e.dialogFormVisible1},on:{"update:visible":function(t){e.dialogFormVisible1=t}}},[n("el-form",{ref:"formLabelAlign1",attrs:{"label-width":"100px",model:e.formLabelAlign1,rules:e.rules}},[n("el-form-item",{attrs:{label:"科室名称",prop:"departmentName"}},[n("el-input",{model:{value:e.formLabelAlign1.departmentName,callback:function(t){e.$set(e.formLabelAlign1,"departmentName",t)},expression:"formLabelAlign1.departmentName"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"上级科室"}},[n("el-cascader",{attrs:{clearable:"",options:e.tableTree,"change-on-select":""},on:{change:e.updatehandleChange},model:{value:e.updateparentid,callback:function(t){e.updateparentid=t},expression:"updateparentid"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogFormVisible1=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.updatedepartment("formLabelAlign1")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var m=n("VU/8")(s,p,!1,function(e){n("AmVZ")},"data-v-056e3915",null);t.default=m.exports},AmVZ:function(e,t){},H5nj:function(e,t,n){"use strict";n.d(t,"f",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return l}),n.d(t,"e",function(){return d}),n.d(t,"b",function(){return s}),n.d(t,"g",function(){return p}),n.d(t,"c",function(){return m});var r=n("FL7F"),a=n("P/kE"),o=(r.a,function(){var e={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId")};return a.n("/department/querytree",e).then(function(e){return e})}),i=function(e,t,n){var r={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),name:e,parentid:t,parentName:n};return a.n("/department/add",r).then(function(e){return e})},l=function(){return a.n("/department/count",{}).then(function(e){return e})},d=function(e){var t={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),departmentid:e};return a.n("/department/find",t).then(function(e){return e})},s=function(e){var t={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),deptId:e};return a.n("/department/delect",t).then(function(e){return e})},p=function(e,t,n,r){var o={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),departmentId:e,name:t,parentid:n,parentName:r};return a.n("/department/update",o).then(function(e){return e})},m=function(e){var t={token:sessionStorage.getItem("token"),userid:sessionStorage.getItem("userId"),deptId:e};return a.n("/department/finddeptree",t).then(function(e){return e})}}});
//# sourceMappingURL=4.a9efedabb6ac0a716e7a.js.map